generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x", "linux-musl", "linux-musl-openssl-3.0.x", "rhel-openssl-1.0.x", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CLIENT
}

enum TenantStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum TenantPlan {
  FREE
  STARTER
  PRO
  ENTERPRISE
}

enum ObligationType {
  PAYMENT
  DOCUMENT
  APPROVAL
}

enum ObligationStatus {
  PENDING
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  CHANGES_REQUESTED
  OVERDUE
}

model Tenant {
  id           String        @id @default(cuid())
  name         String
  slug         String        @unique
  plan         TenantPlan    @default(FREE)
  status       TenantStatus  @default(ACTIVE)
  openClawApiKey String?       @unique
  createdAt    DateTime      @default(now())
  users        User[]
  clients      Client[]
  obligations  Obligation[]
  comments     Comment[]
  activityLogs ActivityLog[]
  attachments  Attachment[]
  transactions Transaction[]
  invoices     Invoice[]

  @@map("tenants")
}

model User {
  id           String    @id @default(cuid())
  tenantId     String
  tenant       Tenant    @relation(fields: [tenantId], references: [id])
  name         String
  email        String    @unique
  passwordHash String
  role         Role
  clientId     String?
  client       Client?   @relation(fields: [clientId], references: [id])
  createdAt    DateTime  @default(now())
  comments     Comment[]
  avatar       String?
}

model Client {
  id          String       @id @default(cuid())
  tenantId    String
  tenant      Tenant       @relation(fields: [tenantId], references: [id])
  name        String
  email       String?
  createdAt   DateTime     @default(now())
  users       User[]
  obligations Obligation[]
  invoices    Invoice[]
}

model Obligation {
  id          String           @id @default(cuid())
  tenantId    String
  tenant      Tenant           @relation(fields: [tenantId], references: [id])
  clientId    String
  client      Client           @relation(fields: [clientId], references: [id])
  title       String
  type        ObligationType
  status      ObligationStatus
  dueDate     DateTime
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  comments    Comment[]
  attachments Attachment[]
}

model Comment {
  id           String     @id @default(cuid())
  tenantId     String
  tenant       Tenant     @relation(fields: [tenantId], references: [id])
  obligationId String
  obligation   Obligation @relation(fields: [obligationId], references: [id])
  userId       String
  user         User       @relation(fields: [userId], references: [id])
  message      String
  createdAt    DateTime   @default(now())
}

model Attachment {
  id           String     @id @default(cuid())
  tenantId     String
  tenant       Tenant     @relation(fields: [tenantId], references: [id])
  obligationId String
  obligation   Obligation @relation(fields: [obligationId], references: [id])
  fileName     String
  fileUrl      String
  createdAt    DateTime   @default(now())
}

model ActivityLog {
  id          String   @id @default(cuid())
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  actorUserId String
  entityType  String   // e.g. OBLIGATION, CLIENT
  entityId    String
  action      String   // e.g. CREATED, STATUS_CHANGED
  meta        Json?
  createdAt   DateTime @default(now())
}

// Novos Models

model Transaction {
  id          String   @id @default(cuid())
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  amount      Decimal
  description String
  date        DateTime
  createdAt   DateTime @default(now())
}

model Invoice {
  id          String        @id @default(cuid())
  tenantId    String
  tenant      Tenant        @relation(fields: [tenantId], references: [id])
  clientId    String
  client      Client        @relation(fields: [clientId], references: [id])
  amount      Decimal
  status      String        // e.g. PAID, PENDING, OVERDUE
  dueDate     DateTime
  items       InvoiceItem[]
  createdAt   DateTime      @default(now())
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  description String
  quantity    Int
  price       Decimal
}
